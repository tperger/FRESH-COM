# FRESH:COM

FaiR Energy SHaring in local COMmunities
<img align="right" height="150" src="https://user-images.githubusercontent.com/48787841/228228557-744dcba5-bc8b-464b-b2b9-3abeab6014ba.jpg">

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.5791940.svg)](https://doi.org/10.5281/zenodo.5791940)


The peer-to-peer electricity trading model FRESH:COM developed by TU Wien is part of the case study “Behavior of communities of actors” within the [Horizon 2020 openENTRANCE project](https://openentrance.eu). 

## Overview on the method

### Modeling framework

<img align="right" src="https://user-images.githubusercontent.com/48787841/228225088-c86b95bd-5f25-41b8-9802-7d935c4f8327.png">

The framework of the modeling approach is a peer-to-peer electricity trading concept in a local energy community. Prosumers (or consumers or producers) join on a voluntary basis and exchange PV electricity generated by community members with one another. The figure on the right side presents the basic idea of the peer-to-peer trading concept in this paper. All members are connected to the public distribution grid to be able to cover the community's residual load, to feed in the surplus PV electricity, and to trade with the other community members (green arrows). Participants in the community are either households or small-to-medium-sized enterprises. The technology portfolio includes PV systems and battery energy storage systems (BESSs). In addition, each prosumer has an individual willingness-to-pay for PV electricity generated by community members, which determines the allocation of the peer-to-peer trading.

The aim of this work is to optimize the dynamic participation of prosumers in an energy community; hence, changes in the set-up of members over time (i.e., exit/entry). In the figure, the orange parts represent a new member joining the community.

In this context, new prosumers are characterized by (i) electricity load/ demand, (ii) electricity generation (PV system and BESS size), and (iii) consumer-type (household or small business). Other characteristics include electrical distance from the other community members, the minimum and maximum number of new prosumers, and the length of binding contracts with the community. The latter is out of scope for this model.

### Flow chart

The minimum length of a contract for prosumer participation in energy communities is assumed to be one year. There is a deadline each year; until then, members can decide to leave the community in the next contract period, or decide to stay and extend the contract for another year. In the meantime, prospective new members can declare interest in joining the community until the annual deadline. The following process is used to optimize dynamic participation in energy communities over a horizon of several years:

<img align="left" height=450 src="https://user-images.githubusercontent.com/48787841/228234079-7f6fc136-0d55-4124-aee3-400e3ee83309.png">


* The starting point is the "old" community, where some members leave at the end of their contract period.

* The status quo of the remaining members is then captured. Previous analyses of peer-to-peer electricity trading under the consideration of prosumers' willingness-to-pay demonstrate two important characteristics for a community and its members: Overall community welfare, and the annual emissions and costs of each member. These indicators are obtained by solving a linear program (see the model presented in [1]) to maximize community welfare of the original community configuration. The annual costs and emissions are then used as "benchmarks" for the optimization process.

* After decisions about leaving, staying, or joining the community are made by all existing and potential new members, a bi-level optimization problem is solved to determine the optimal configuration of new prosumers. The lower level problem is linear community welfare maximization that was applied to the original community in the previous step to obtain benchmarks. The upper-level problem determines which potential members are selected by the community, and subsequently, the new prosumers' parameters (annual electricity demand and peak capacity of the installed PV systems).

* Finally, the new community is defined and the process repeats in the next year.

In this model, the implementation of the proposed method is conducted for one period (year) in order to focus on the selection process of the community that is conducted using the bi-level optimization approach. 


## How to run the model

### Requirements

* [Python](https://www.python.org/) working on your computer
* the [Pyomo](http://www.pyomo.org/) package
* [Gurobi](https://www.gurobi.com/) (or other solver) 
* the [pyam](pyam-iamc.readthedocs.io/) package 

### Files

* `FRESH_main.py` is the main file of the model
* `FRESH_LP.py` solves the linear program for optimal allocation of peer-to-peer trading in an energy community (corresponds with minor changes to the model presented in [1])
* `FRESH_KKT.py` solves the bi-level model for dynamic participation (explained in [2])
* `FRESH_define_community.py` uses the *pyam* package to process input data presented in the [openENTRANCE common data format](https://github.com/openENTRANCE/openentrance)
* `FRESH_clustering.py` clusters hourly input data that is available for one year into representative days using *k-means*
* `FRESH_plots.py`creates figures and graphs that are shown in [2]

## Scientific publications
[1] T. Perger, L. Wachter, A. Fleischhacker, H. Auer, PV sharing in local communities: Peer-to-peer trading under consideration of the prosumers’ willingness-to-pay, In: Sustainable Cities and Society (2021), DOI: https://doi.org/10.1016/j.scs.2020.102634 

[2] Perger T and Auer H. Dynamic participation in local energy communities with peer-to-peer trading [version 1; peer review: 1 approved]. Open Research Europe 2022, 2:5 (https://doi.org/10.12688/openreseurope.14332.1)

## Licence

Copyright 2020 Theresia Perger

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
